\hypertarget{Tracer_8h_source}{}\doxysection{Tracer.\+h}
\label{Tracer_8h_source}\index{/home/debian/Skipper/src/include/classes/Tracer.h@{/home/debian/Skipper/src/include/classes/Tracer.h}}
\mbox{\hyperlink{Tracer_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 }
\DoxyCodeLine{11 \textcolor{preprocessor}{\#ifndef MY\_TRACER\_header}}
\DoxyCodeLine{12 \textcolor{preprocessor}{\#define MY\_TRACER\_header}}
\DoxyCodeLine{13 }
\DoxyCodeLine{14 \textcolor{preprocessor}{\#define X86}}
\DoxyCodeLine{15 }
\DoxyCodeLine{16 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{Config_8h}{Config.h}}"{}}}
\DoxyCodeLine{17 }
\DoxyCodeLine{19 \textcolor{keyword}{struct }\mbox{\hyperlink{structCodeSegmentDescriber}{CodeSegmentDescriber}} \{}
\DoxyCodeLine{20     \textcolor{keywordtype}{size\_t} start;}
\DoxyCodeLine{21     \textcolor{keywordtype}{size\_t} end;}
\DoxyCodeLine{22 \};}
\DoxyCodeLine{23 }
\DoxyCodeLine{25 \textcolor{keyword}{struct }\mbox{\hyperlink{structTraceArea}{TraceArea}} \{}
\DoxyCodeLine{26     \textcolor{keywordtype}{size\_t} start;}
\DoxyCodeLine{27     \textcolor{keywordtype}{size\_t} end;}
\DoxyCodeLine{28     \textcolor{keywordtype}{size\_t} size;}
\DoxyCodeLine{29 \};}
\DoxyCodeLine{30 }
\DoxyCodeLine{32 \textcolor{keywordtype}{int} \mbox{\hyperlink{Tracer_8h_a123d1a69b9cc1c4ef9d6cfa21c8660e5}{get\_msb\_ind}}(uint x) \{}
\DoxyCodeLine{33     \textcolor{keywordflow}{if} (x == 0)}
\DoxyCodeLine{34         \textcolor{keywordflow}{return} -\/1; \textcolor{comment}{// Возвращает -\/1, если нет установленных битов}}
\DoxyCodeLine{35 }
\DoxyCodeLine{36     \textcolor{keywordtype}{int} msb\_index = 0;}
\DoxyCodeLine{37     \textcolor{keywordflow}{while} (x >>= 1) \{}
\DoxyCodeLine{38         msb\_index++;}
\DoxyCodeLine{39     \}}
\DoxyCodeLine{40     \textcolor{keywordflow}{return} msb\_index;}
\DoxyCodeLine{41 \}}
\DoxyCodeLine{42 }
\DoxyCodeLine{55 \textcolor{keywordtype}{int} \mbox{\hyperlink{Tracer_8h_a50d52849f73aeaddc776d9de6fbeac5a}{trace\_overflow}}(\textcolor{keywordtype}{int}* offset\_int\_ptr, uint32\_t size, uint32\_t ind, uint32\_t reg\_id) \{}
\DoxyCodeLine{56     \textcolor{comment}{// offset -\/ адрес памяти, куда писать}}
\DoxyCodeLine{57     \textcolor{comment}{// size -\/ размер памяти}}
\DoxyCodeLine{58     \textcolor{comment}{// ind -\/ индекс add}}
\DoxyCodeLine{59     \textcolor{comment}{// reg\_id -\/ индекс регистра в DynamoRIO}}
\DoxyCodeLine{60 }
\DoxyCodeLine{61     \textcolor{keywordtype}{char}* offset = (\textcolor{keywordtype}{char}*) offset\_int\_ptr;}
\DoxyCodeLine{62     reg\_id\_t dst\_reg = (reg\_id\_t) reg\_id;}
\DoxyCodeLine{63     \textcolor{keywordflow}{if} (size < 65*(ind+1)) \{}
\DoxyCodeLine{64         \textcolor{comment}{// TODO : надо проверить, как работает}}
\DoxyCodeLine{65         printf(\textcolor{stringliteral}{"{}memory is not enough for tracing\(\backslash\)n"{}});}
\DoxyCodeLine{66     \}}
\DoxyCodeLine{67 }
\DoxyCodeLine{68     \textcolor{comment}{// восстанавливаем контекст}}
\DoxyCodeLine{69     dr\_mcontext\_t mc = \{ \textcolor{keyword}{sizeof}(mc), DR\_MC\_ALL\};}
\DoxyCodeLine{70     dr\_get\_mcontext(dr\_get\_current\_drcontext(), \&mc);}
\DoxyCodeLine{71 }
\DoxyCodeLine{72     \textcolor{comment}{// регистр флагов}}
\DoxyCodeLine{73     reg\_t xflags = mc.xflags;}
\DoxyCodeLine{74     \textcolor{comment}{// регистр назначения}}
\DoxyCodeLine{75     reg\_t reg = reg\_get\_value(dst\_reg, \&mc);}
\DoxyCodeLine{76 }
\DoxyCodeLine{77     \textcolor{comment}{// находим индекс старшего бита}}
\DoxyCodeLine{78     \textcolor{keywordtype}{int} msb\_ind\_reg = \mbox{\hyperlink{Tracer_8h_a123d1a69b9cc1c4ef9d6cfa21c8660e5}{get\_msb\_ind}}((uint) reg);}
\DoxyCodeLine{79 }
\DoxyCodeLine{80     \textcolor{comment}{// трейсим}}
\DoxyCodeLine{81     \textcolor{keywordflow}{if} (msb\_ind\_reg >= 0) \{}
\DoxyCodeLine{82         ((\textcolor{keywordtype}{char} *)offset)[(ind*65+msb\_ind\_reg) \% size] += 1;}
\DoxyCodeLine{83     \}}
\DoxyCodeLine{84     ((\textcolor{keywordtype}{char} *)offset)[(ind*65+64) \% size] += xflags \& EFLAGS\_CF;}
\DoxyCodeLine{85     }
\DoxyCodeLine{86     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{87 \}}
\DoxyCodeLine{88 }
\DoxyCodeLine{104 \textcolor{keywordtype}{void} \mbox{\hyperlink{Tracer_8h_ac543296ab3c51210dd61838f989023a8}{insert\_tracing}}(\textcolor{keywordtype}{void} *drcontext, \textcolor{keywordtype}{void} *tag, instrlist\_t *bb, instr\_t *where, }
\DoxyCodeLine{105                     \textcolor{keywordtype}{char}* offset, uint32\_t size, uint32\_t ind, uint32\_t reg\_id) \{}
\DoxyCodeLine{106     \textcolor{keyword}{auto} xax = DR\_REG\_XAX;}
\DoxyCodeLine{107     \textcolor{keyword}{auto} xbx = DR\_REG\_XBX;}
\DoxyCodeLine{108     \textcolor{keyword}{auto} xcx = DR\_REG\_XCX;}
\DoxyCodeLine{109     \textcolor{keyword}{auto} xdx = DR\_REG\_XDX;}
\DoxyCodeLine{110 }
\DoxyCodeLine{111     \textcolor{comment}{// сохраняем регистры и флаги}}
\DoxyCodeLine{112     dr\_save\_arith\_flags(drcontext, bb, where, SPILL\_SLOT\_2); \textcolor{comment}{// по умолчанию кладёт в xax}}
\DoxyCodeLine{113     dr\_save\_reg(drcontext, bb, where, xax, SPILL\_SLOT\_3);}
\DoxyCodeLine{114     dr\_save\_reg(drcontext, bb, where, xbx, SPILL\_SLOT\_4);}
\DoxyCodeLine{115     dr\_save\_reg(drcontext, bb, where, xcx, SPILL\_SLOT\_5);}
\DoxyCodeLine{116     dr\_save\_reg(drcontext, bb, where, xdx, SPILL\_SLOT\_6);}
\DoxyCodeLine{117     }
\DoxyCodeLine{118     instr\_t * instr;}
\DoxyCodeLine{119 }
\DoxyCodeLine{120     \textcolor{comment}{// сохраняем значение исследуемого регистра в RCX}}
\DoxyCodeLine{121     instr = XINST\_CREATE\_move(}
\DoxyCodeLine{122         drcontext,}
\DoxyCodeLine{123         opnd\_create\_reg(DR\_REG\_RCX),}
\DoxyCodeLine{124         opnd\_create\_reg(reg\_id)}
\DoxyCodeLine{125     );}
\DoxyCodeLine{126     instrlist\_meta\_preinsert(bb, where, instr);}
\DoxyCodeLine{127 }
\DoxyCodeLine{128     \textcolor{comment}{// =========================================================================}}
\DoxyCodeLine{129     \textcolor{comment}{// get\_msb\_ind}}
\DoxyCodeLine{130     \textcolor{comment}{// RCX -\/ исследуемый регистр хранится}}
\DoxyCodeLine{131     \textcolor{comment}{// RAX -\/ возвращаемый результат}}
\DoxyCodeLine{132     \textcolor{comment}{// создаём метки mgb\_loop, msb\_finish, msb\_ret\_minus\_1}}
\DoxyCodeLine{133 }
\DoxyCodeLine{134     instr = INSTR\_CREATE\_xor(}
\DoxyCodeLine{135         drcontext,}
\DoxyCodeLine{136         opnd\_create\_reg(DR\_REG\_RAX),}
\DoxyCodeLine{137         opnd\_create\_reg(DR\_REG\_RAX)}
\DoxyCodeLine{138     );}
\DoxyCodeLine{139     instrlist\_meta\_preinsert(bb, where, instr);}
\DoxyCodeLine{140     instr = INSTR\_CREATE\_bsr(}
\DoxyCodeLine{141         drcontext,}
\DoxyCodeLine{142         opnd\_create\_reg(DR\_REG\_RAX),}
\DoxyCodeLine{143         opnd\_create\_reg(DR\_REG\_RCX)}
\DoxyCodeLine{144     );}
\DoxyCodeLine{145     instrlist\_meta\_preinsert(bb, where, instr);}
\DoxyCodeLine{146     instr = INSTR\_CREATE\_mov\_imm(}
\DoxyCodeLine{147         drcontext,}
\DoxyCodeLine{148         opnd\_create\_reg(DR\_REG\_RCX),}
\DoxyCodeLine{149         OPND\_CREATE\_INT64(0x3f)}
\DoxyCodeLine{150     );}
\DoxyCodeLine{151     instrlist\_meta\_preinsert(bb, where, instr);}
\DoxyCodeLine{152     instr = INSTR\_CREATE\_and(}
\DoxyCodeLine{153         drcontext,}
\DoxyCodeLine{154         opnd\_create\_reg(DR\_REG\_RAX),}
\DoxyCodeLine{155         opnd\_create\_reg(DR\_REG\_RCX)}
\DoxyCodeLine{156     );}
\DoxyCodeLine{157     instrlist\_meta\_preinsert(bb, where, instr);}
\DoxyCodeLine{158 }
\DoxyCodeLine{159 }
\DoxyCodeLine{160     \textcolor{comment}{// ==============================================================================}}
\DoxyCodeLine{161     \textcolor{comment}{// теперь результат функции помещаем в RCX и инкрементаируем соответствующий байт}}
\DoxyCodeLine{162     }
\DoxyCodeLine{163     instr = XINST\_CREATE\_move(}
\DoxyCodeLine{164         drcontext,}
\DoxyCodeLine{165         opnd\_create\_reg(DR\_REG\_RCX),}
\DoxyCodeLine{166         opnd\_create\_reg(DR\_REG\_RAX)}
\DoxyCodeLine{167     );}
\DoxyCodeLine{168     instrlist\_meta\_preinsert(bb, where, instr);}
\DoxyCodeLine{169     \textcolor{comment}{// ответ в RCX}}
\DoxyCodeLine{170     \textcolor{comment}{// записываем адрес в RAX}}
\DoxyCodeLine{171     \textcolor{keyword}{auto} pos = ind*65;}
\DoxyCodeLine{172     instr = INSTR\_CREATE\_mov\_imm(}
\DoxyCodeLine{173         drcontext,}
\DoxyCodeLine{174         opnd\_create\_reg(DR\_REG\_RAX),}
\DoxyCodeLine{175         OPND\_CREATE\_INT64(offset+pos)}
\DoxyCodeLine{176     );}
\DoxyCodeLine{177     instrlist\_meta\_preinsert(bb, where, instr);}
\DoxyCodeLine{178     instr = INSTR\_CREATE\_add(}
\DoxyCodeLine{179         drcontext,}
\DoxyCodeLine{180         opnd\_create\_reg(DR\_REG\_RAX),}
\DoxyCodeLine{181         opnd\_create\_reg(DR\_REG\_RCX)}
\DoxyCodeLine{182     );}
\DoxyCodeLine{183     instrlist\_meta\_preinsert(bb, where, instr);}
\DoxyCodeLine{184 }
\DoxyCodeLine{185     instr = INSTR\_CREATE\_mov\_ld(}
\DoxyCodeLine{186         drcontext,}
\DoxyCodeLine{187         opnd\_create\_reg(DR\_REG\_DL),}
\DoxyCodeLine{188         OPND\_CREATE\_MEM8(DR\_REG\_RAX, 0)}
\DoxyCodeLine{189     );}
\DoxyCodeLine{190     instrlist\_meta\_preinsert(bb, where, instr);}
\DoxyCodeLine{191     \textcolor{comment}{// прибавляем 1}}
\DoxyCodeLine{192     instr = INSTR\_CREATE\_inc(}
\DoxyCodeLine{193         drcontext,}
\DoxyCodeLine{194         opnd\_create\_reg(DR\_REG\_DL)}
\DoxyCodeLine{195     );}
\DoxyCodeLine{196     instrlist\_meta\_preinsert(bb, where, instr);}
\DoxyCodeLine{197     \textcolor{comment}{// кладём новое значение по адресу}}
\DoxyCodeLine{198     instr = XINST\_CREATE\_store(}
\DoxyCodeLine{199         drcontext,}
\DoxyCodeLine{200         OPND\_CREATE\_MEM8(DR\_REG\_RAX, 0),}
\DoxyCodeLine{201         opnd\_create\_reg(DR\_REG\_DL)}
\DoxyCodeLine{202     );}
\DoxyCodeLine{203     instrlist\_meta\_preinsert(bb, where, instr);}
\DoxyCodeLine{204 }
\DoxyCodeLine{205     \textcolor{comment}{// =========================================================================}}
\DoxyCodeLine{206     \textcolor{comment}{// заняты RAX под адрес, RCX под флаги, RDX -\/ вспомогательный}}
\DoxyCodeLine{207     \textcolor{comment}{// берём сохранённые флаги и кладём в reg RCX}}
\DoxyCodeLine{208     dr\_restore\_reg(}
\DoxyCodeLine{209         drcontext, bb, where, (reg\_id\_t) DR\_REG\_RCX, SPILL\_SLOT\_2}
\DoxyCodeLine{210     );}
\DoxyCodeLine{211     \textcolor{comment}{// по идее их всего 6 и должно прокатить, если я использую eax вместо rax}}
\DoxyCodeLine{212     instr = INSTR\_CREATE\_and(}
\DoxyCodeLine{213         drcontext,}
\DoxyCodeLine{214         opnd\_create\_reg(DR\_REG\_ECX),}
\DoxyCodeLine{215         OPND\_CREATE\_INT32((uint32\_t) EFLAGS\_CF)}
\DoxyCodeLine{216     );}
\DoxyCodeLine{217     instrlist\_meta\_preinsert(bb, where, instr);}
\DoxyCodeLine{218     \textcolor{comment}{// сохраняем в памяти флаг}}
\DoxyCodeLine{219     \textcolor{keyword}{auto} i = (ind*65+64) \% size;}
\DoxyCodeLine{220     \textcolor{comment}{// формируем адрес}}
\DoxyCodeLine{221     instr = INSTR\_CREATE\_mov\_imm(}
\DoxyCodeLine{222         drcontext,}
\DoxyCodeLine{223         opnd\_create\_reg(DR\_REG\_RAX),}
\DoxyCodeLine{224         OPND\_CREATE\_INT64(offset)}
\DoxyCodeLine{225     );}
\DoxyCodeLine{226     instrlist\_meta\_preinsert(bb, where, instr);}
\DoxyCodeLine{227     \textcolor{comment}{// читаем, что лежит по адресу данного байта}}
\DoxyCodeLine{228     instr = INSTR\_CREATE\_mov\_ld(}
\DoxyCodeLine{229         drcontext,}
\DoxyCodeLine{230         opnd\_create\_reg(DR\_REG\_DL),}
\DoxyCodeLine{231         OPND\_CREATE\_MEM8(DR\_REG\_RAX, i)}
\DoxyCodeLine{232     );}
\DoxyCodeLine{233     instrlist\_meta\_preinsert(bb, where, instr);}
\DoxyCodeLine{234     \textcolor{comment}{// прибавляем бит CF регистра флагов}}
\DoxyCodeLine{235     instr = INSTR\_CREATE\_add(}
\DoxyCodeLine{236         drcontext,}
\DoxyCodeLine{237         opnd\_create\_reg(DR\_REG\_DL),}
\DoxyCodeLine{238         opnd\_create\_reg(DR\_REG\_CL)}
\DoxyCodeLine{239     );}
\DoxyCodeLine{240     instrlist\_meta\_preinsert(bb, where, instr);}
\DoxyCodeLine{241     \textcolor{comment}{// кладём новое значение по адресу}}
\DoxyCodeLine{242     instr = XINST\_CREATE\_store(}
\DoxyCodeLine{243         drcontext,}
\DoxyCodeLine{244         OPND\_CREATE\_MEM8(DR\_REG\_RAX, i),}
\DoxyCodeLine{245         opnd\_create\_reg(DR\_REG\_DL)}
\DoxyCodeLine{246     );}
\DoxyCodeLine{247     instrlist\_meta\_preinsert(bb, where, instr);}
\DoxyCodeLine{248 }
\DoxyCodeLine{249     \textcolor{comment}{// возвращаем регистры и флаги на место}}
\DoxyCodeLine{250     dr\_restore\_reg(drcontext, bb, where, xdx, SPILL\_SLOT\_6);}
\DoxyCodeLine{251     dr\_restore\_reg(drcontext, bb, where, xcx, SPILL\_SLOT\_5);}
\DoxyCodeLine{252     dr\_restore\_reg(drcontext, bb, where, xbx, SPILL\_SLOT\_4);}
\DoxyCodeLine{253     dr\_restore\_reg(drcontext, bb, where, xax, SPILL\_SLOT\_3);}
\DoxyCodeLine{254     dr\_restore\_arith\_flags(drcontext, bb, where, SPILL\_SLOT\_2);}
\DoxyCodeLine{255 \}}
\DoxyCodeLine{256 }
\DoxyCodeLine{261 \textcolor{keyword}{class }\mbox{\hyperlink{classTracer}{Tracer}} \{}
\DoxyCodeLine{262     \mbox{\hyperlink{structTraceArea}{TraceArea}} trace\_area;}
\DoxyCodeLine{264     std::map<app\_pc, size\_t> pc\_ind\_map;}
\DoxyCodeLine{266     std::map<reg\_id\_t, size\_t> reg\_ind\_map;}
\DoxyCodeLine{267 \textcolor{keyword}{public}:}
\DoxyCodeLine{268     json tracer\_config;}
\DoxyCodeLine{269     \mbox{\hyperlink{classTracer}{Tracer}}() \{\}}
\DoxyCodeLine{270 }
\DoxyCodeLine{272     \textcolor{keywordtype}{bool} \mbox{\hyperlink{classTracer_afc07eaef479ab4f68ebea2baec8b6b3b}{set\_config}}(\mbox{\hyperlink{classConfigurator}{Configurator}} config) \{}
\DoxyCodeLine{273         std::cout << \textcolor{stringliteral}{"{}setting config to tracer!"{}} << std::endl;}
\DoxyCodeLine{274         this-\/>tracer\_config = config.\mbox{\hyperlink{classConfigurator_ad54923859a18f257292fca330d5cf215}{getTracerConfig}}();}
\DoxyCodeLine{275         \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{276     \}}
\DoxyCodeLine{277 }
\DoxyCodeLine{279     \textcolor{keywordtype}{void} \mbox{\hyperlink{classTracer_ad41b93151174779e6278996a024b6937}{set\_trace\_area}}(\textcolor{keywordtype}{size\_t} start, \textcolor{keywordtype}{size\_t} end) \{}
\DoxyCodeLine{280         this-\/>trace\_area = \{start, end, end-\/start\};}
\DoxyCodeLine{281     \}}
\DoxyCodeLine{282 }
\DoxyCodeLine{283 \textcolor{keyword}{protected}:}
\DoxyCodeLine{285     \textcolor{keywordtype}{int} \mbox{\hyperlink{classTracer_af5756bea912ded6d7d5f5460796ec34c}{get\_reg\_id}}(reg\_id\_t reg) \{}
\DoxyCodeLine{286         \textcolor{keyword}{auto} iter = this-\/>reg\_ind\_map.find(reg);}
\DoxyCodeLine{287         \textcolor{keywordflow}{if} (iter != this-\/>reg\_ind\_map.end()) \{}
\DoxyCodeLine{288             \textcolor{keywordflow}{return} this-\/>reg\_ind\_map[reg];}
\DoxyCodeLine{289         \}}
\DoxyCodeLine{290         this-\/>reg\_ind\_map[reg] = this-\/>reg\_ind\_map.size();}
\DoxyCodeLine{291         \textcolor{keywordflow}{return} this-\/>reg\_ind\_map[reg];}
\DoxyCodeLine{292     \}}
\DoxyCodeLine{293 \textcolor{keyword}{public}:}
\DoxyCodeLine{303     \textcolor{keywordtype}{void} \mbox{\hyperlink{classTracer_a09d420c495a39a8c71642a20aa2f4495}{traceOverflow}}(\textcolor{keywordtype}{void} *drcontext, \textcolor{keywordtype}{void} *tag, instrlist\_t *bb, instr\_t *instr) \{}
\DoxyCodeLine{304         \textcolor{keywordflow}{if} (!instr\_num\_dsts(instr)) \{}
\DoxyCodeLine{305             \textcolor{keywordflow}{return};}
\DoxyCodeLine{306         \}}
\DoxyCodeLine{307 }
\DoxyCodeLine{308         opnd\_t dst = instr\_get\_dst(instr, 0);}
\DoxyCodeLine{309         \textcolor{keywordflow}{if} (!opnd\_is\_reg(dst)) \{}
\DoxyCodeLine{310             \textcolor{keywordflow}{return};}
\DoxyCodeLine{311         \}}
\DoxyCodeLine{312 }
\DoxyCodeLine{313         reg\_id\_t dst\_reg = opnd\_get\_reg(dst);}
\DoxyCodeLine{314         \textcolor{keywordtype}{int} reg\_ind = this-\/>\mbox{\hyperlink{classTracer_af5756bea912ded6d7d5f5460796ec34c}{get\_reg\_id}}(dst\_reg);}
\DoxyCodeLine{315 }
\DoxyCodeLine{316         app\_pc instr\_pc = instr\_get\_app\_pc(instr);}
\DoxyCodeLine{317         \textcolor{comment}{// если эту инструкцию ещё не встречали -\/ выдаём ей номер}}
\DoxyCodeLine{318         \textcolor{keywordflow}{if} (this-\/>pc\_ind\_map.find(instr\_pc) == this-\/>pc\_ind\_map.end()) \{}
\DoxyCodeLine{319             this-\/>pc\_ind\_map[instr\_pc] = this-\/>pc\_ind\_map.size();}
\DoxyCodeLine{320         \}}
\DoxyCodeLine{321         \textcolor{keywordtype}{size\_t} ind = this-\/>pc\_ind\_map[instr\_pc];}
\DoxyCodeLine{322 }
\DoxyCodeLine{323         \textcolor{keyword}{auto} * module = dr\_get\_main\_module();}
\DoxyCodeLine{324         \textcolor{keyword}{auto} pc = module-\/>start;}
\DoxyCodeLine{325         dr\_free\_module\_data(module);}
\DoxyCodeLine{326         \textcolor{keywordtype}{size\_t} start\_size\_t = (size\_t) this-\/>trace\_area.start + (\textcolor{keywordtype}{size\_t}) pc;}
\DoxyCodeLine{327 }
\DoxyCodeLine{328         instr\_t *nxt = instr\_get\_next(instr);}
\DoxyCodeLine{329         \textcolor{keywordflow}{if} (this-\/>tracer\_config[\textcolor{stringliteral}{"{}use\_asm"{}}]) \{}
\DoxyCodeLine{330             \textcolor{keywordflow}{if} (this-\/>tracer\_config[\textcolor{stringliteral}{"{}debug"{}}]) \{}
\DoxyCodeLine{331                 main\_logger.log\_debug(\textcolor{stringliteral}{"{}using inline-\/asm instrumentation!"{}});}
\DoxyCodeLine{332                 dr\_printf(\textcolor{stringliteral}{"{}[DEBUG] : using inline-\/asm instrumentation!\(\backslash\)n"{}});}
\DoxyCodeLine{333             \}}
\DoxyCodeLine{334 }
\DoxyCodeLine{335             \mbox{\hyperlink{Tracer_8h_ac543296ab3c51210dd61838f989023a8}{insert\_tracing}}(drcontext, tag, bb, nxt, }
\DoxyCodeLine{336                           (\textcolor{keywordtype}{char}*) start\_size\_t, this-\/>trace\_area.size, ind, dst\_reg);}
\DoxyCodeLine{337         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{338             \textcolor{keywordflow}{if} (this-\/>tracer\_config[\textcolor{stringliteral}{"{}debug"{}}]) \{}
\DoxyCodeLine{339                 main\_logger.log\_debug(\textcolor{stringliteral}{"{}using clean\_call instrumentation!"{}});}
\DoxyCodeLine{340                 dr\_printf(\textcolor{stringliteral}{"{}[DEBUG] : using clean\_call instrumentation!\(\backslash\)n"{}});}
\DoxyCodeLine{341             \}}
\DoxyCodeLine{342             }
\DoxyCodeLine{343             dr\_insert\_clean\_call\_ex(drcontext, }
\DoxyCodeLine{344                                     bb, nxt, }
\DoxyCodeLine{345                                     (\textcolor{keywordtype}{void} *) \mbox{\hyperlink{Tracer_8h_a50d52849f73aeaddc776d9de6fbeac5a}{trace\_overflow}}, }
\DoxyCodeLine{346                                     (dr\_cleancall\_save\_t) (DR\_CLEANCALL\_READS\_APP\_CONTEXT | DR\_CLEANCALL\_MULTIPATH),}
\DoxyCodeLine{347                                     4, }
\DoxyCodeLine{348                                     OPND\_CREATE\_INTPTR(start\_size\_t),}
\DoxyCodeLine{349                                     OPND\_CREATE\_INT32(this-\/>trace\_area.size),}
\DoxyCodeLine{350                                     OPND\_CREATE\_INT32(ind),}
\DoxyCodeLine{351                                     OPND\_CREATE\_INT32(dst\_reg));}
\DoxyCodeLine{352         \}}
\DoxyCodeLine{353         \textcolor{keywordflow}{if} (this-\/>tracer\_config[\textcolor{stringliteral}{"{}debug"{}}]) \{}
\DoxyCodeLine{354             main\_logger.log\_debug(\textcolor{stringliteral}{"{}add number: \{\} | add index: \{\} | thread id: \{\}"{}}, }
\DoxyCodeLine{355                                   this-\/>pc\_ind\_map.size(), ind, \mbox{\hyperlink{funcs_8h_aba532940df77bb2847dcabd25caf5b59}{get\_thread\_id}}());}
\DoxyCodeLine{356             dr\_printf(\textcolor{stringliteral}{"{}[DEBUG] : add number: \%d | add index: \%d | thread id: \%s\(\backslash\)n"{}}, }
\DoxyCodeLine{357                       this-\/>pc\_ind\_map.size(), ind, \mbox{\hyperlink{funcs_8h_aba532940df77bb2847dcabd25caf5b59}{get\_thread\_id}}().c\_str());}
\DoxyCodeLine{358         \}}
\DoxyCodeLine{359     \}}
\DoxyCodeLine{360 \};}
\DoxyCodeLine{361 }
\DoxyCodeLine{362 \textcolor{preprocessor}{\#endif }\textcolor{comment}{// MY\_TRACER\_header}}

\end{DoxyCode}
